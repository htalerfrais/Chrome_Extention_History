---
alwaysApply: true
---

# Current Architecture - Chrome Extension History Project

> **âš ï¸ IMPORTANT**: This document must be updated whenever the architecture is modified, components are added/removed, or significant structural changes are made to the project.

## Overview

This is a **Chrome Extension + Backend API** system that analyzes browsing history and organizes it into thematic sessions. The architecture follows a client-server pattern with local data processing and remote analysis capabilities.

## High-Level Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CHROME EXTENSION (Frontend)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Background Service Worker  â”‚  Popup Interface  â”‚  Dashboard UI  â”‚
â”‚  - Data Collection          â”‚  - Quick Search   â”‚  - Full Analysisâ”‚
â”‚  - Real-time Updates       â”‚  - History Lookup â”‚  - Session View â”‚
â”‚  - Local Storage           â”‚  - Simple UI      â”‚  - Theme Clustersâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â”‚ HTTP API Calls
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BACKEND API (Python FastAPI)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  FastAPI Server  â”‚  Clustering Service  â”‚  Data Models         â”‚
â”‚  - REST Endpointsâ”‚  - Theme Detection   â”‚  - Session Schemas   â”‚
â”‚  - Health Checks â”‚  - Pattern Analysis  â”‚  - Validation        â”‚
â”‚  - CORS Support  â”‚  - Keyword Matching  â”‚  - Type Safety       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Component Responsibilities

### **Frontend (Chrome Extension)**

#### **Background Service Worker** (`background.js`)
- **Responsibility**: Continuous data collection and preprocessing
- **Key Functions**:
  - Collects Chrome history data (up to 5000 items)
  - Real-time updates via `chrome.history.onVisited` listener
  - Stores preprocessed data in `chrome.storage.local`
  - Applies URL filtering and deduplication

#### **Popup Interface** (`popup.html`, `popup.js`)
- **Responsibility**: Quick access search interface
- **Key Functions**:
  - Simple search functionality across stored history
  - Displays search results with favicons and metadata
  - Provides access to full dashboard
  - Compact 320px width design

#### **Dashboard Interface** (`dashboard.html`, `dashboard.js`)
- **Responsibility**: Comprehensive analysis and visualization
- **Key Functions**:
  - Orchestrates the complete analysis workflow
  - Displays session-based browsing patterns
  - Shows thematic clusters with visual cards
  - Handles API communication and error states
  - Session tab navigation

#### **Data Processing Layer** (`utils/`)
- **Session Manager** (`session_management.js`):
  - Groups history items into time-based sessions (120min gap)
  - Formats data for API consumption
  - Handles session statistics and validation
- **History Preprocessor** (`preprocess_history.js`):
  - URL normalization and cleaning
  - Duplicate detection and removal
  - Feature extraction (hostname, path, search queries)
  - Date formatting and enrichment

#### **API Client** (`api/`)
- **API Client** (`api_client.js`):
  - Handles HTTP communication with backend
  - Implements retry logic and error handling
  - Manages request timeouts and failures
- **Configuration** (`config.js`):
  - Environment management (dev/production)
  - API endpoint configuration
  - Request settings and timeouts

### **Backend (Python FastAPI)**

#### **API Server** (`main.py`)
- **Responsibility**: RESTful API endpoints and request handling
- **Key Functions**:
  - Health check endpoints (`/`, `/health`)
  - Clustering endpoint (`/cluster`)
  - CORS configuration for Chrome extension
  - Error handling and logging

#### **Clustering Service** (`clustering_service.py`)
- **Responsibility**: Theme detection and pattern analysis
- **Key Functions**:
  - Keyword-based theme detection
  - Domain-specific pattern matching
  - Session-independent clustering
  - Theme scoring and categorization

#### **Data Models** (`session_models.py`)
- **Responsibility**: Data structure definition and validation
- **Key Models**:
  - `HistoryItem`: Individual browsing entry
  - `HistorySession`: Time-grouped browsing session
  - `ClusterResult`: Thematic grouping result
  - `SessionClusteringResponse`: API response format

## Data Flow

1. **Data Collection**: Chrome history â†’ Background worker â†’ Local storage
2. **Analysis Request**: Dashboard â†’ Session grouping â†’ API call to backend
3. **Processing**: Backend receives sessions â†’ Theme detection â†’ Clustering
4. **Response**: Backend returns clustered results â†’ Dashboard visualization

## Key Design Patterns

- **Service Worker Pattern**: Background processing for continuous data collection
- **API Gateway Pattern**: Centralized backend service for complex processing
- **Session-based Processing**: Groups related browsing activities by time
- **Theme-based Clustering**: Categorizes pages by detected topics/themes
- **Separation of Concerns**: Extension handles UI/data collection, backend handles analysis

## Technology Stack

### Frontend
- **Chrome Extension API**: History, Storage, Tabs permissions
- **Vanilla JavaScript**: No frameworks, pure ES6+
- **CSS Custom Properties**: Consistent theming system
- **Local Storage**: Chrome storage API for data persistence

### Backend
- **FastAPI**: Modern Python web framework
- **Pydantic**: Data validation and serialization
- **Docker**: Containerized deployment
- **Uvicorn**: ASGI server

## Configuration

- **Session Gap**: 120 minutes between sessions
- **History Limit**: 5000 items maximum
- **API Timeout**: 30 seconds for main requests
- **Retry Logic**: 3 attempts with exponential backoff
- **Theme Detection**: Keyword-based pattern matching

## Deployment

- **Extension**: Chrome Web Store (future) / Developer mode (current)
- **Backend**: Docker container on localhost:8000 (dev) / Cloud (production)
- **Development**: Docker Compose for local development

---

**Last Updated**: [Current Date]
**Version**: 0.2.0
**Status**: In Progress ğŸš§# Current Architecture - Chrome Extension History Project

> **âš ï¸ IMPORTANT**: This document must be updated whenever the architecture is modified, components are added/removed, or significant structural changes are made to the project.

## Overview

This is a **Chrome Extension + Backend API** system that analyzes browsing history and organizes it into thematic sessions. The architecture follows a client-server pattern with local data processing and remote analysis capabilities.

## High-Level Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CHROME EXTENSION (Frontend)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Background Service Worker  â”‚  Popup Interface  â”‚  Dashboard UI  â”‚
â”‚  - Data Collection          â”‚  - Quick Search   â”‚  - Full Analysisâ”‚
â”‚  - Real-time Updates       â”‚  - History Lookup â”‚  - Session View â”‚
â”‚  - Local Storage           â”‚  - Simple UI      â”‚  - Theme Clustersâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â”‚ HTTP API Calls
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BACKEND API (Python FastAPI)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  FastAPI Server  â”‚  Clustering Service  â”‚  Data Models         â”‚
â”‚  - REST Endpointsâ”‚  - Theme Detection   â”‚  - Session Schemas   â”‚
â”‚  - Health Checks â”‚  - Pattern Analysis  â”‚  - Validation        â”‚
â”‚  - CORS Support  â”‚  - Keyword Matching  â”‚  - Type Safety       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Component Responsibilities

### **Frontend (Chrome Extension)**

#### **Background Service Worker** (`background.js`)
- **Responsibility**: Continuous data collection and preprocessing
- **Key Functions**:
  - Collects Chrome history data (up to 5000 items)
  - Real-time updates via `chrome.history.onVisited` listener
  - Stores preprocessed data in `chrome.storage.local`
  - Applies URL filtering and deduplication

#### **Popup Interface** (`popup.html`, `popup.js`)
- **Responsibility**: Quick access search interface
- **Key Functions**:
  - Simple search functionality across stored history
  - Displays search results with favicons and metadata
  - Provides access to full dashboard
  - Compact 320px width design

#### **Dashboard Interface** (`dashboard.html`, `dashboard.js`)
- **Responsibility**: Comprehensive analysis and visualization
- **Key Functions**:
  - Orchestrates the complete analysis workflow
  - Displays session-based browsing patterns
  - Shows thematic clusters with visual cards
  - Handles API communication and error states
  - Session tab navigation

#### **Data Processing Layer** (`utils/`)
- **Session Manager** (`session_management.js`):
  - Groups history items into time-based sessions (120min gap)
  - Formats data for API consumption
  - Handles session statistics and validation
- **History Preprocessor** (`preprocess_history.js`):
  - URL normalization and cleaning
  - Duplicate detection and removal
  - Feature extraction (hostname, path, search queries)
  - Date formatting and enrichment

#### **API Client** (`api/`)
- **API Client** (`api_client.js`):
  - Handles HTTP communication with backend
  - Implements retry logic and error handling
  - Manages request timeouts and failures
- **Configuration** (`config.js`):
  - Environment management (dev/production)
  - API endpoint configuration
  - Request settings and timeouts

### **Backend (Python FastAPI)**

#### **API Server** (`main.py`)
- **Responsibility**: RESTful API endpoints and request handling
- **Key Functions**:
  - Health check endpoints (`/`, `/health`)
  - Clustering endpoint (`/cluster`)
  - CORS configuration for Chrome extension
  - Error handling and logging

#### **Clustering Service** (`clustering_service.py`)
- **Responsibility**: Theme detection and pattern analysis
- **Key Functions**:
  - Keyword-based theme detection
  - Domain-specific pattern matching
  - Session-independent clustering
  - Theme scoring and categorization

#### **Data Models** (`session_models.py`)
- **Responsibility**: Data structure definition and validation
- **Key Models**:
  - `HistoryItem`: Individual browsing entry
  - `HistorySession`: Time-grouped browsing session
  - `ClusterResult`: Thematic grouping result
  - `SessionClusteringResponse`: API response format

## Data Flow

1. **Data Collection**: Chrome history â†’ Background worker â†’ Local storage
2. **Analysis Request**: Dashboard â†’ Session grouping â†’ API call to backend
3. **Processing**: Backend receives sessions â†’ Theme detection â†’ Clustering
4. **Response**: Backend returns clustered results â†’ Dashboard visualization

## Key Design Patterns

- **Service Worker Pattern**: Background processing for continuous data collection
- **API Gateway Pattern**: Centralized backend service for complex processing
- **Session-based Processing**: Groups related browsing activities by time
- **Theme-based Clustering**: Categorizes pages by detected topics/themes
- **Separation of Concerns**: Extension handles UI/data collection, backend handles analysis

## Technology Stack

### Frontend
- **Chrome Extension API**: History, Storage, Tabs permissions
- **Vanilla JavaScript**: No frameworks, pure ES6+
- **CSS Custom Properties**: Consistent theming system
- **Local Storage**: Chrome storage API for data persistence

### Backend
- **FastAPI**: Modern Python web framework
- **Pydantic**: Data validation and serialization
- **Docker**: Containerized deployment
- **Uvicorn**: ASGI server

## Configuration

- **Session Gap**: 120 minutes between sessions
- **History Limit**: 5000 items maximum
- **API Timeout**: 30 seconds for main requests
- **Retry Logic**: 3 attempts with exponential backoff
- **Theme Detection**: Keyword-based pattern matching

## Deployment

- **Extension**: Chrome Web Store (future) / Developer mode (current)
- **Backend**: Docker container on localhost:8000 (dev) / Cloud (production)
- **Development**: Docker Compose for local development

---

**Last Updated**: [Current Date]
**Version**: 0.2.0
**Status**: In Progress ğŸš§